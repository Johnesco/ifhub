<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Importing Games &mdash; IF Hub</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html, body {
  min-height: 100%;
  background: #0a0a0a;
  color: #d4c5a9;
  font-family: Georgia, "Times New Roman", serif;
}

.page {
  max-width: 820px;
  margin: 0 auto;
  padding: 40px 24px 80px;
}

h1 {
  font-size: 1.6em;
  color: #e8d8b0;
  margin-bottom: 6px;
}

.subtitle {
  font-size: 0.95em;
  color: #806050;
  margin-bottom: 40px;
}

.subtitle a {
  color: #a08060;
  text-decoration: none;
  border-bottom: 1px solid transparent;
}

.subtitle a:hover {
  color: #c0a880;
  border-bottom-color: #c0a880;
}

h2 {
  font-size: 1.2em;
  color: #e8d090;
  margin: 40px 0 12px;
  padding-bottom: 6px;
  border-bottom: 1px solid #2a2418;
}

h3 {
  font-size: 1em;
  color: #c4b48a;
  margin: 28px 0 8px;
}

p {
  line-height: 1.7;
  margin-bottom: 12px;
  color: #b8a888;
}

strong {
  color: #d4c5a9;
  font-weight: bold;
}

em {
  color: #a09070;
}

a {
  color: #a08060;
}

code {
  font-family: "SF Mono", "Fira Code", Consolas, "Courier New", monospace;
  font-size: 0.88em;
  background: #151008;
  border: 1px solid #1e1a14;
  border-radius: 3px;
  padding: 1px 5px;
  color: #c4b48a;
}

pre {
  font-family: "SF Mono", "Fira Code", Consolas, "Courier New", monospace;
  font-size: 0.85em;
  background: #0e0c08;
  border: 1px solid #1e1a14;
  border-radius: 6px;
  padding: 16px 20px;
  margin: 12px 0 20px;
  overflow-x: auto;
  line-height: 1.6;
  color: #b8a888;
}

pre code {
  background: none;
  border: none;
  padding: 0;
  font-size: inherit;
  color: inherit;
}

pre .comment { color: #605840; font-style: italic; }
pre .string { color: #8bab6e; }
pre .key { color: #c08050; }
pre .flag { color: #7ea8b0; }
pre .path { color: #aa9966; }

ol {
  padding-left: 28px;
  margin-bottom: 16px;
}

ol li {
  line-height: 1.7;
  margin-bottom: 8px;
  color: #b8a888;
}

ul {
  padding-left: 28px;
  margin-bottom: 16px;
  list-style-type: disc;
}

ul li {
  line-height: 1.7;
  margin-bottom: 4px;
  color: #b8a888;
}

.step-number {
  display: inline-block;
  width: 28px;
  height: 28px;
  line-height: 28px;
  text-align: center;
  background: #1a1510;
  border: 1px solid #3a3020;
  border-radius: 50%;
  color: #e8d090;
  font-size: 0.85em;
  font-weight: bold;
  margin-right: 8px;
  flex-shrink: 0;
}

.steps {
  list-style: none;
  padding-left: 0;
  counter-reset: step;
}

.steps > li {
  counter-increment: step;
  margin-bottom: 32px;
  padding-left: 44px;
  position: relative;
}

.steps > li::before {
  content: counter(step);
  position: absolute;
  left: 0;
  top: 1px;
  width: 28px;
  height: 28px;
  line-height: 28px;
  text-align: center;
  background: #1a1510;
  border: 1px solid #3a3020;
  border-radius: 50%;
  color: #e8d090;
  font-size: 0.85em;
  font-weight: bold;
}

.file-table {
  width: 100%;
  border-collapse: collapse;
  margin: 12px 0 20px;
  font-size: 0.9em;
}

.file-table th {
  text-align: left;
  padding: 8px 12px;
  border-bottom: 2px solid #2a2418;
  color: #c4b48a;
  font-weight: bold;
}

.file-table td {
  padding: 6px 12px;
  border-bottom: 1px solid #1a1810;
  color: #b8a888;
  vertical-align: top;
}

.file-table tr:hover td {
  background: #0e0c08;
}

.tag {
  display: inline-block;
  font-size: 0.75em;
  padding: 1px 8px;
  border-radius: 3px;
  font-family: "SF Mono", "Fira Code", Consolas, "Courier New", monospace;
  vertical-align: middle;
}

.tag-required {
  background: #2a1a10;
  border: 1px solid #5a3a20;
  color: #c08050;
}

.tag-optional {
  background: #1a1a10;
  border: 1px solid #3a3a20;
  color: #808060;
}

.note {
  background: #1a1510;
  border: 1px solid #3a3020;
  border-radius: 6px;
  padding: 14px 18px;
  margin: 16px 0;
  font-size: 0.9em;
  color: #aa9966;
  line-height: 1.6;
}

.note strong {
  color: #c4b48a;
}

hr {
  border: none;
  border-top: 1px solid #1e1a14;
  margin: 40px 0;
}

.toc {
  background: #0e0c08;
  border: 1px solid #1e1a14;
  border-radius: 6px;
  padding: 16px 20px;
  margin-bottom: 32px;
}

.toc-title {
  font-size: 0.85em;
  color: #806050;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 8px;
}

.toc a {
  display: block;
  padding: 3px 0;
  font-size: 0.9em;
  color: #998866;
  text-decoration: none;
}

.toc a:hover {
  color: #e8d090;
}
</style>
</head>
<body>

<div class="page">

<h1>Importing Games into IF Hub</h1>
<p class="subtitle"><a href="index.html">&larr; Back to IF Hub</a></p>

<div class="toc">
  <div class="toc-title">Contents</div>
  <a href="#overview">Overview</a>
  <a href="#prerequisites">Prerequisites</a>
  <a href="#file-reference">File Reference</a>
  <a href="#step-by-step">Step-by-Step Import</a>
  <a href="#walkthrough">Adding a Walkthrough (Optional)</a>
  <a href="#checklist">Verification Checklist</a>
  <a href="#examples">Examples</a>
</div>

<!-- ===== OVERVIEW ===== -->
<h2 id="overview">Overview</h2>

<p>IF Hub is a web-based reader for Inform 7 interactive fiction games. Each game appears in a dropdown selector and can be played in-browser (via Parchment) while viewing the source code side-by-side. Games can optionally include a walkthrough viewer.</p>

<p>Importing a game requires changes to three files:</p>

<ul>
  <li><code>games.json</code> &mdash; game metadata (title, file paths)</li>
  <li><code>deploy.sh</code> &mdash; file-copy definitions (source repo &rarr; <code>games/</code>)</li>
  <li>The game's own repo &mdash; must have a compiled <code>.ulx.js</code> binary and <code>story.ni</code> source</li>
</ul>

<!-- ===== PREREQUISITES ===== -->
<h2 id="prerequisites">Prerequisites</h2>

<p>Before importing, the game project must have these files ready:</p>

<table class="file-table">
  <tr>
    <th>File</th>
    <th>Purpose</th>
    <th>Status</th>
  </tr>
  <tr>
    <td><code>story.ni</code></td>
    <td>Inform 7 source code (displayed in the Source tab)</td>
    <td><span class="tag tag-required">required</span></td>
  </tr>
  <tr>
    <td><code>{name}.ulx.js</code></td>
    <td>Base64-encoded Glulx binary (loaded by Parchment)</td>
    <td><span class="tag tag-required">required</span></td>
  </tr>
  <tr>
    <td><code>walkthrough.html</code></td>
    <td>Walkthrough viewer page</td>
    <td><span class="tag tag-optional">optional</span></td>
  </tr>
  <tr>
    <td><code>walkthrough.txt</code></td>
    <td>Raw walkthrough commands (one per line)</td>
    <td><span class="tag tag-optional">optional</span></td>
  </tr>
  <tr>
    <td><code>walkthrough-guide.txt</code></td>
    <td>Annotated guide with sections and commentary</td>
    <td><span class="tag tag-optional">optional</span></td>
  </tr>
  <tr>
    <td><code>walkthrough_output.txt</code></td>
    <td>Full game transcript (enables Game Text and Replay modes)</td>
    <td><span class="tag tag-optional">optional</span></td>
  </tr>
</table>

<h3>Building the binary</h3>

<p>The <code>.ulx.js</code> file is created by compiling the Inform 7 source to a Glulx binary, then base64-encoding it into a JavaScript wrapper:</p>

<pre><code><span class="comment"># Step 1: Compile I7 source to I6</span>
"/c/Program Files/Inform7IDE/Compilers/inform7.exe" \
    <span class="flag">-internal</span> "/c/Program Files/Inform7IDE/Internal" \
    <span class="flag">-source</span> story.ni \
    <span class="flag">-o</span> story.i6 \
    <span class="flag">-silence</span>

<span class="comment"># Step 2: Compile I6 to Glulx</span>
"/c/Program Files/Inform7IDE/Compilers/inform6.exe" <span class="flag">-w -G</span> \
    story.i6 \
    <span class="path">mygame.ulx</span>

<span class="comment"># Step 3: Base64-encode into JS wrapper</span>
B64=$(base64 <span class="flag">-w 0</span> <span class="path">mygame.ulx</span>) &amp;&amp; \
    echo "processBase64Zcode('${B64}')" > <span class="path">mygame.ulx.js</span>

<span class="comment"># Step 4: Clean up intermediate files</span>
rm story.i6</code></pre>

<p>The resulting <code>.ulx.js</code> file contains a single <code>processBase64Zcode('...')</code> call that Parchment uses to load the game.</p>

<!-- ===== FILE REFERENCE ===== -->
<h2 id="file-reference">File Reference</h2>

<h3>games.json</h3>

<p>An array of game entries. Each entry has these fields:</p>

<table class="file-table">
  <tr>
    <th>Field</th>
    <th>Type</th>
    <th>Description</th>
  </tr>
  <tr>
    <td><code>id</code></td>
    <td>string</td>
    <td>Unique identifier, used in URL params and directory names</td>
  </tr>
  <tr>
    <td><code>title</code></td>
    <td>string</td>
    <td>Display name shown in the dropdown and page title</td>
  </tr>
  <tr>
    <td><code>sourceLabel</code></td>
    <td>string</td>
    <td>Filename shown in the source toolbar (e.g. <code>mygame.ni</code>)</td>
  </tr>
  <tr>
    <td><code>source</code></td>
    <td>string</td>
    <td>Path to <code>story.ni</code> relative to IF Hub root</td>
  </tr>
  <tr>
    <td><code>binary</code></td>
    <td>string</td>
    <td>Path to <code>.ulx.js</code> relative to IF Hub root</td>
  </tr>
  <tr>
    <td><code>walkthrough</code></td>
    <td>string?</td>
    <td>Path to <code>walkthrough.html</code> (omit if none)</td>
  </tr>
</table>

<h3>deploy.sh</h3>

<p>The deploy script copies files from sibling project repos into the <code>games/</code> directory. It has two definition sections:</p>

<ul>
  <li><strong>GAMES array</strong> &mdash; space-separated triples: <code>id  source-path  binary-path</code> (paths relative to <code>$I7_ROOT</code>, which is the parent of the ifhub directory)</li>
  <li><strong>WALKTHROUGH_DIRS map</strong> &mdash; maps game id to the directory containing walkthrough files (relative to <code>$I7_ROOT</code>)</li>
</ul>

<h3>games/ directory layout</h3>

<p>After deployment, each game has its own directory:</p>

<pre><code>games/
  mygame/
    story.ni                <span class="comment"># Inform 7 source</span>
    mygame.ulx.js           <span class="comment"># base64 binary</span>
    walkthrough.html         <span class="comment"># viewer (if walkthrough exists)</span>
    walkthrough.txt          <span class="comment"># commands</span>
    walkthrough-guide.txt    <span class="comment"># annotated guide</span>
    walkthrough_output.txt   <span class="comment"># transcript</span></code></pre>

<!-- ===== STEP BY STEP ===== -->
<h2 id="step-by-step">Step-by-Step Import</h2>

<p>Assume the game is called <strong>"mygame"</strong> and lives at <code>C:\code\ifhub\mygame\</code>.</p>

<ol class="steps">
  <li>
    <h3>Verify the game project has the required files</h3>
    <p>Confirm these exist in the game's repo:</p>
    <ul>
      <li><code>story.ni</code> &mdash; the Inform 7 source</li>
      <li><code>web/lib/parchment/mygame.ulx.js</code> &mdash; the base64 binary</li>
    </ul>
    <p>If the binary doesn't exist, compile it using the build steps above.</p>
  </li>

  <li>
    <h3>Add entry to <code>games.json</code></h3>
    <p>Add a new object to the array. Place it in the order you want it to appear in the dropdown:</p>
<pre><code>{
  <span class="key">"id"</span>: <span class="string">"mygame"</span>,
  <span class="key">"title"</span>: <span class="string">"My Game"</span>,
  <span class="key">"sourceLabel"</span>: <span class="string">"mygame.ni"</span>,
  <span class="key">"source"</span>: <span class="string">"games/mygame/story.ni"</span>,
  <span class="key">"binary"</span>: <span class="string">"games/mygame/mygame.ulx.js"</span>
}</code></pre>
  </li>

  <li>
    <h3>Add entry to <code>deploy.sh</code></h3>
    <p>Add a line to the <code>GAMES</code> array. Paths are relative to <code>$I7_ROOT</code> (the parent of the ifhub directory, i.e. <code>C:\code\ifhub\</code>):</p>
<pre><code>GAMES=(
  <span class="comment"># ...existing entries...</span>
  <span class="string">"mygame     mygame/story.ni     mygame/web/lib/parchment/mygame.ulx.js"</span>
)</code></pre>
  </li>

  <li>
    <h3>Run the deploy script</h3>
<pre><code>cd C:\code\ifhub\ifhub
wsl -e bash -c "cd /mnt/c/code/ifhub/ifhub &amp;&amp; bash deploy.sh"</code></pre>
    <p>Verify the output shows your game's files copied without warnings:</p>
<pre><code>  mygame: story.ni copied
  mygame: mygame.ulx.js copied</code></pre>
  </li>

  <li>
    <h3>Test in browser</h3>
<pre><code>python -m http.server 8000 --directory C:/code/ifhub/ifhub</code></pre>
    <p>Open <code>http://localhost:8000/</code> and select the new game from the dropdown. Verify:</p>
    <ul>
      <li>Game loads and is playable in the left pane</li>
      <li>Source code appears in the right pane with syntax highlighting</li>
      <li>Walkthrough tab shows "not yet available" (until you add one)</li>
    </ul>
  </li>
</ol>

<!-- ===== WALKTHROUGH ===== -->
<h2 id="walkthrough">Adding a Walkthrough (Optional)</h2>

<p>The walkthrough viewer is a self-contained HTML page that fetches three data files via relative paths. It supports three modes: <strong>Commands</strong> (annotated step list), <strong>Game Text</strong> (full transcript), and <strong>Replay</strong> (animated playback).</p>

<h3>Required files</h3>

<p>All walkthrough files must live in the same directory:</p>

<table class="file-table">
  <tr>
    <th>File</th>
    <th>Purpose</th>
    <th>Modes enabled</th>
  </tr>
  <tr>
    <td><code>walkthrough.txt</code></td>
    <td>One command per line, in play order</td>
    <td>Commands (raw fallback)</td>
  </tr>
  <tr>
    <td><code>walkthrough-guide.txt</code></td>
    <td>Annotated guide with <code>##</code> sections and <code>&gt;</code> commands</td>
    <td>Commands (with sections + sidebar nav)</td>
  </tr>
  <tr>
    <td><code>walkthrough_output.txt</code></td>
    <td>Game transcript generated by running walkthrough commands</td>
    <td>Game Text, Replay</td>
  </tr>
  <tr>
    <td><code>walkthrough.html</code></td>
    <td>The viewer page itself</td>
    <td>&mdash;</td>
  </tr>
</table>

<div class="note">
  <strong>Graceful degradation:</strong> The viewer works with partial files. If only <code>walkthrough.txt</code> exists, Commands mode shows a raw numbered list. If the transcript is missing, the Game Text and Replay buttons are disabled. If the guide is missing, Commands mode works but without section headers or sidebar navigation.
</div>

<h3>Creating the walkthrough files</h3>

<ol class="steps">
  <li>
    <h3>Write <code>walkthrough.txt</code></h3>
    <p>One command per line, in the order a player would type them. This is often already present in a game's test suite:</p>
<pre><code>take key
n
open door
look
s
take lamp</code></pre>
  </li>

  <li>
    <h3>Generate <code>walkthrough_output.txt</code></h3>
    <p>Pipe the commands into the game interpreter to capture the transcript. If the project uses the shared testing framework:</p>
<pre><code>wsl -e bash tests/run-walkthrough.sh</code></pre>
    <p>This saves output to the path configured in <code>tests/project.conf</code> (the <code>PRIMARY_OUTPUT_FILE</code> setting). Otherwise, generate it manually:</p>
<pre><code>cat walkthrough.txt | $HOME/glulxe/glulxe mygame.ulx > walkthrough_output.txt</code></pre>
  </li>

  <li>
    <h3>Write <code>walkthrough-guide.txt</code></h3>
    <p>An annotated version of the commands, organized into sections. Format:</p>
<pre><code><span class="comment">## Section Title -- Subtitle</span>

<span class="string">> command here</span>

Commentary text explaining the step.

<span class="comment">## Next Section -- Another Room</span>

<span class="string">> another command</span>

More commentary.</code></pre>
    <p>Lines starting with <code>##</code> become section headers (and sidebar nav entries). Lines starting with <code>&gt;</code> are commands. Everything else is commentary (displayed in the guide but not in the viewer's Commands mode). The <code>--</code> in headers separates title from subtitle.</p>
  </li>

  <li>
    <h3>Create <code>walkthrough.html</code></h3>
    <p>Copy an existing walkthrough viewer from another game and change three things:</p>
    <ul>
      <li>The <code>&lt;title&gt;</code> tag</li>
      <li>The sidebar header (<code>&lt;h1&gt;</code>) and back link</li>
      <li>The <code>localStorage</code> key for replay speed (search for <code>-replay-speed</code>)</li>
    </ul>
    <p>The data file URLs (<code>walkthrough.txt</code>, <code>walkthrough-guide.txt</code>, <code>walkthrough_output.txt</code>) are hardcoded as relative paths, so they work as long as all files are in the same directory.</p>
  </li>

  <li>
    <h3>Place all four files together</h3>
    <p>Put them in the game's <code>web/</code> directory (or wherever the project keeps web assets):</p>
<pre><code>mygame/
  web/
    walkthrough.html
    walkthrough.txt
    walkthrough-guide.txt
    walkthrough_output.txt</code></pre>
  </li>

  <li>
    <h3>Wire up IF Hub</h3>
    <p>Add the <code>walkthrough</code> field to the game's entry in <code>games.json</code>:</p>
<pre><code>{
  <span class="key">"id"</span>: <span class="string">"mygame"</span>,
  <span class="comment">...other fields...</span>
  <span class="key">"walkthrough"</span>: <span class="string">"games/mygame/walkthrough.html"</span>
}</code></pre>
    <p>Add the game to the <code>WALKTHROUGH_DIRS</code> map in <code>deploy.sh</code>:</p>
<pre><code>WALKTHROUGH_DIRS=(
  <span class="comment"># ...existing entries...</span>
  [mygame]=<span class="string">"mygame/web"</span>
)</code></pre>
  </li>

  <li>
    <h3>Deploy and test</h3>
<pre><code>wsl -e bash -c "cd /mnt/c/code/ifhub/ifhub &amp;&amp; bash deploy.sh"</code></pre>
    <p>Verify walkthrough files are copied, then test in browser: select the game, click the Walkthrough tab, and confirm all three modes work.</p>
  </li>
</ol>

<!-- ===== CHECKLIST ===== -->
<h2 id="checklist">Verification Checklist</h2>

<p>After importing, confirm each of these:</p>

<table class="file-table">
  <tr><th>Check</th><th>How to verify</th></tr>
  <tr>
    <td>Game appears in dropdown</td>
    <td>Open IF Hub, check the "Load Game" selector</td>
  </tr>
  <tr>
    <td>Game is playable</td>
    <td>Select it, type a command in the game pane</td>
  </tr>
  <tr>
    <td>Source code loads</td>
    <td>Source tab shows highlighted <code>.ni</code> with line numbers</td>
  </tr>
  <tr>
    <td>Source navigation works</td>
    <td>Sidebar shows headings, clicking scrolls to section</td>
  </tr>
  <tr>
    <td>Walkthrough loads (if added)</td>
    <td>Walkthrough tab shows Commands mode with numbered steps</td>
  </tr>
  <tr>
    <td>Game Text mode works</td>
    <td>Click "Game Text" button, transcript displays with room highlighting</td>
  </tr>
  <tr>
    <td>Replay mode works</td>
    <td>Click "Replay", press Play, animated typing begins</td>
  </tr>
  <tr>
    <td>Walkthrough fallback</td>
    <td>Games without walkthrough show "not yet available" message</td>
  </tr>
  <tr>
    <td>Tab toggle works</td>
    <td>Clicking active tab collapses pane, clicking again restores it</td>
  </tr>
  <tr>
    <td>URL parameter works</td>
    <td><code>?game=mygame</code> loads the correct game on page load</td>
  </tr>
</table>

<!-- ===== EXAMPLES ===== -->
<h2 id="examples">Examples</h2>

<h3>Minimal import (no walkthrough)</h3>

<p>Dracula has source and binary but no walkthrough:</p>

<pre><code><span class="comment">// games.json</span>
{
  <span class="key">"id"</span>: <span class="string">"dracula"</span>,
  <span class="key">"title"</span>: <span class="string">"Dracula\u2019s Castle"</span>,
  <span class="key">"sourceLabel"</span>: <span class="string">"dracula.ni"</span>,
  <span class="key">"source"</span>: <span class="string">"games/dracula/story.ni"</span>,
  <span class="key">"binary"</span>: <span class="string">"games/dracula/dracula.ulx.js"</span>
}</code></pre>

<pre><code><span class="comment"># deploy.sh GAMES array</span>
<span class="string">"dracula     dracula/story.ni     dracula/web/lib/parchment/dracula.ulx.js"</span></code></pre>

<h3>Full import (with walkthrough)</h3>

<p>Zork v3 has everything &mdash; source, binary, and a complete walkthrough with guide and transcript:</p>

<pre><code><span class="comment">// games.json</span>
{
  <span class="key">"id"</span>: <span class="string">"zork1-v3"</span>,
  <span class="key">"title"</span>: <span class="string">"Zork I (v3)"</span>,
  <span class="key">"sourceLabel"</span>: <span class="string">"zork1-v3.ni"</span>,
  <span class="key">"source"</span>: <span class="string">"games/zork1-v3/story.ni"</span>,
  <span class="key">"binary"</span>: <span class="string">"games/zork1-v3/zork1.ulx.js"</span>,
  <span class="key">"walkthrough"</span>: <span class="string">"games/zork1-v3/walkthrough.html"</span>
}</code></pre>

<pre><code><span class="comment"># deploy.sh</span>
GAMES=(
  <span class="string">"zork1-v3    projects/zork1/versions/v3/story.ni     projects/zork1/versions/v3/lib/parchment/zork1.ulx.js"</span>
)

WALKTHROUGH_DIRS=(
  [zork1-v3]=<span class="string">"projects/zork1/versions/v3"</span>
)</code></pre>

<h3>Multiple versions of the same game</h3>

<p>Use a versioned id to distinguish variants (e.g. <code>zork1-v1</code>, <code>zork1-v2</code>, <code>zork1-v3</code>). Each gets its own <code>games/</code> subdirectory and independent walkthrough files.</p>

</div>

</body>
</html>
