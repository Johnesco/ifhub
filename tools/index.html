<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Inform 7 Hub &mdash; Developer Reference</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root {
  --bg-page: #0a0a0a;
  --bg-content: #111;
  --bg-code: #1c1810;
  --bg-toolbar: #0e0a08;
  --text-primary: #d4c5a9;
  --text-heading: #e8d8b0;
  --text-gold: #e8d090;
  --text-accent: #aa9966;
  --text-warm: #cc8844;
  --text-muted: #806050;
  --border: #2a2418;
  --success: #8bab6e;
  --font-serif: Georgia, "Times New Roman", serif;
  --font-mono: "SF Mono", "Fira Code", "Cascadia Code", Consolas, monospace;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html {
  scroll-behavior: smooth;
  scrollbar-color: #3a3020 #1a1a1a;
}

body {
  background: var(--bg-page);
  color: var(--text-primary);
  font-family: var(--font-serif);
  font-size: 16px;
  line-height: 1.6;
}

/* --- Sticky Nav --- */
nav {
  position: sticky;
  top: 0;
  z-index: 100;
  background: var(--bg-toolbar);
  border-bottom: 1px solid var(--border);
  padding: 0 20px;
  display: flex;
  align-items: center;
  gap: 24px;
  height: 42px;
  font-size: 0.85em;
  overflow-x: auto;
  white-space: nowrap;
}

nav .nav-title {
  font-weight: bold;
  color: var(--text-heading);
  letter-spacing: 1px;
  flex-shrink: 0;
}

nav a {
  color: var(--text-muted);
  text-decoration: none;
  transition: color 0.15s;
  flex-shrink: 0;
}

nav a:hover,
nav a.active {
  color: var(--text-gold);
}

/* --- Main Content --- */
main {
  max-width: 900px;
  margin: 0 auto;
  padding: 0 24px 80px;
}

section {
  border-bottom: 1px solid var(--border);
  padding: 48px 0;
}

section:last-child {
  border-bottom: none;
}

h1 {
  font-size: 2em;
  color: var(--text-heading);
  font-weight: normal;
  letter-spacing: 2px;
}

h2 {
  font-size: 1.4em;
  color: var(--text-heading);
  font-weight: normal;
  margin-bottom: 20px;
  letter-spacing: 1px;
}

h3 {
  font-size: 1.05em;
  color: var(--text-gold);
  font-weight: normal;
  margin-bottom: 8px;
}

p {
  margin-bottom: 12px;
}

/* --- Hero --- */
.hero {
  text-align: center;
  padding: 56px 0 48px;
}

.hero h1 {
  margin-bottom: 8px;
}

.hero .subtitle {
  color: var(--text-accent);
  font-size: 1.1em;
  margin-bottom: 16px;
}

.hero .hub-path {
  font-family: var(--font-mono);
  font-size: 0.85em;
  color: var(--text-muted);
}

/* --- Directory Tree --- */
.tree {
  background: var(--bg-code);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 20px 24px;
  font-family: var(--font-mono);
  font-size: 0.85em;
  line-height: 1.7;
  overflow-x: auto;
  white-space: pre;
}

.tree .dir {
  color: var(--text-gold);
}

.tree .file {
  color: var(--text-primary);
}

.tree .desc {
  color: var(--text-muted);
}

/* --- Pipeline --- */
.pipeline {
  display: flex;
  align-items: flex-start;
  gap: 0;
  flex-wrap: wrap;
  justify-content: center;
  margin: 24px 0;
}

.pipeline-step {
  background: var(--bg-content);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 16px;
  width: 130px;
  text-align: center;
  flex-shrink: 0;
}

.pipeline-step .step-num {
  font-family: var(--font-mono);
  font-size: 0.75em;
  color: var(--text-muted);
  margin-bottom: 4px;
}

.pipeline-step .step-title {
  color: var(--text-gold);
  font-size: 0.95em;
  margin-bottom: 6px;
}

.pipeline-step .step-cmd {
  font-family: var(--font-mono);
  font-size: 0.72em;
  color: var(--text-accent);
  word-break: break-all;
}

.pipeline-step .step-output {
  font-size: 0.75em;
  color: var(--text-muted);
  margin-top: 6px;
}

.pipeline-arrow {
  display: flex;
  align-items: center;
  padding: 0 4px;
  color: var(--text-muted);
  font-size: 1.2em;
  margin-top: 24px;
  flex-shrink: 0;
}

@media (max-width: 700px) {
  .pipeline {
    flex-direction: column;
    align-items: center;
  }
  .pipeline-arrow {
    transform: rotate(90deg);
    margin-top: 0;
    padding: 4px 0;
  }
}

/* --- Cards --- */
.card {
  background: var(--bg-content);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 20px 24px;
  margin-bottom: 16px;
}

.card h3 {
  display: flex;
  align-items: center;
  gap: 10px;
}

.badge {
  display: inline-block;
  font-family: var(--font-mono);
  font-size: 0.7em;
  color: var(--text-warm);
  border: 1px solid var(--text-warm);
  border-radius: 3px;
  padding: 1px 6px;
  vertical-align: middle;
}

.card .purpose {
  color: var(--text-accent);
  font-size: 0.9em;
  margin-bottom: 12px;
}

.card pre {
  background: var(--bg-code);
  border-radius: 4px;
  padding: 12px 16px;
  font-family: var(--font-mono);
  font-size: 0.82em;
  color: var(--text-primary);
  overflow-x: auto;
  margin-bottom: 12px;
  line-height: 1.5;
}

.card ul {
  list-style: none;
  padding: 0;
}

.card ul li {
  padding: 3px 0;
  font-size: 0.9em;
  color: var(--text-primary);
}

.card ul li::before {
  content: "\2022";
  color: var(--text-muted);
  margin-right: 8px;
}

/* --- Tables --- */
table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.9em;
}

th {
  text-align: left;
  color: var(--text-accent);
  font-weight: normal;
  font-size: 0.85em;
  letter-spacing: 1px;
  text-transform: uppercase;
  padding: 8px 12px;
  border-bottom: 1px solid var(--border);
}

td {
  padding: 10px 12px;
  border-bottom: 1px solid #1a1810;
  vertical-align: top;
}

tr:last-child td {
  border-bottom: none;
}

td.name {
  color: var(--text-gold);
  font-weight: bold;
  white-space: nowrap;
}

td .check {
  color: var(--success);
}

td .dash {
  color: var(--text-muted);
}

td a {
  color: var(--text-gold);
  text-decoration: none;
}

td a:hover {
  text-decoration: underline;
}

td code {
  font-family: var(--font-mono);
  font-size: 0.9em;
  color: var(--text-accent);
}

/* --- Code blocks (standalone) --- */
pre.code-block {
  background: var(--bg-code);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 14px 18px;
  font-family: var(--font-mono);
  font-size: 0.82em;
  color: var(--text-primary);
  overflow-x: auto;
  margin-bottom: 12px;
  line-height: 1.5;
}

pre.code-block .comment {
  color: var(--text-muted);
}

/* --- Footer --- */
footer {
  text-align: center;
  padding: 32px 0;
  color: var(--text-muted);
  font-size: 0.85em;
}

footer code {
  font-family: var(--font-mono);
  font-size: 0.95em;
}

footer a {
  color: var(--text-accent);
  text-decoration: none;
}

footer a:hover {
  color: var(--text-gold);
}

/* --- Scrollbar --- */
::-webkit-scrollbar { width: 8px; height: 8px; }
::-webkit-scrollbar-track { background: #1a1a1a; }
::-webkit-scrollbar-thumb { background: #3a3020; border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: #5a4a30; }
</style>

</head>
<body>

<!-- ===== Nav ===== -->
<nav>
  <span class="nav-title">Inform 7 Hub</span>
  <a href="#structure">Structure</a>
  <a href="#pipeline">Pipeline</a>
  <a href="#tools">Tools</a>
  <a href="#projects">Projects</a>
  <a href="#reference">Reference</a>
  <a href="#commands">Commands</a>
</nav>

<!-- ===== Hero ===== -->
<main>
<section class="hero" style="border-bottom: 1px solid #2a2418;">
  <h1>Inform 7 Hub</h1>
  <p class="subtitle">Developer Reference &amp; Build Tools</p>
  <p class="hub-path">C:\code\ifhub\</p>
</section>

<!-- ===== Hub Structure ===== -->
<section id="structure">
  <h2>Hub Structure</h2>
  <div class="tree"><span class="dir">C:\code\ifhub\</span>
<span class="file">CLAUDE.md</span>              <span class="desc">Hub documentation &amp; conventions</span>
<span class="dir">reference/</span>             <span class="desc">Inform 7 language reference (9 guides)</span>
<span class="dir">tools/</span>                 <span class="desc">Shared build, test, and web tooling</span>
    <span class="file">build-site.sh</span>      <span class="desc">Assemble _site/ from web/ + versions/</span>
    <span class="file">compile.sh</span>         <span class="desc">Compile story.ni &rarr; .ulx + web player</span>
    <span class="file">new-project.sh</span>     <span class="desc">Scaffold a complete new project</span>
    <span class="file">publish.sh</span>         <span class="desc">Deploy to GitHub Pages</span>
    <span class="file">regtest.py</span>         <span class="desc">Shared RegTest runner</span>
    <span class="file">snapshot.sh</span>        <span class="desc">Freeze source into a version snapshot</span>
    <span class="dir">testing/</span>           <span class="desc">Generic testing framework</span>
    <span class="dir">web/</span>               <span class="desc">Parchment web player setup</span>
    <span class="file">index.html</span>         <span class="desc">This page</span>
<span class="dir">projects/</span>              <span class="desc">Game projects</span>
    <span class="dir">dracula/</span>           <span class="desc">Dracula: Inform 7 Edition</span>
    <span class="dir">feverdream/</span>        <span class="desc">Fever Dream</span>
    <span class="dir">sample/</span>            <span class="desc">Sample practice game</span>
    <span class="dir">zork1/</span>             <span class="desc">Zork I: Inform 7 Edition</span>
        <span class="dir">web/</span>           <span class="desc">Site-level pages (landing, map, scenarios)</span>
        <span class="dir">versions/</span>      <span class="desc">Frozen version snapshots (v0&ndash;v3)</span>
<span class="dir">ifhub/</span>                 <span class="desc">IF Hub &mdash; multi-game web player</span></div>
</section>

<!-- ===== Build Pipeline ===== -->
<section id="pipeline">
  <h2>Build Pipeline</h2>
  <p>From blank project to published game in six steps.</p>

  <div class="pipeline">
    <div class="pipeline-step">
      <div class="step-num">1</div>
      <div class="step-title">Create</div>
      <div class="step-cmd">new-project.sh</div>
      <div class="step-output">project scaffold</div>
    </div>
    <div class="pipeline-arrow">&rarr;</div>
    <div class="pipeline-step">
      <div class="step-num">2</div>
      <div class="step-title">Write</div>
      <div class="step-cmd">story.ni</div>
      <div class="step-output">Inform 7 source</div>
    </div>
    <div class="pipeline-arrow">&rarr;</div>
    <div class="pipeline-step">
      <div class="step-num">3</div>
      <div class="step-title">Compile</div>
      <div class="step-cmd">compile.sh</div>
      <div class="step-output">.ulx + web player</div>
    </div>
    <div class="pipeline-arrow">&rarr;</div>
    <div class="pipeline-step">
      <div class="step-num">4</div>
      <div class="step-title">Test</div>
      <div class="step-cmd">run-tests.sh</div>
      <div class="step-output">pass / fail</div>
    </div>
    <div class="pipeline-arrow">&rarr;</div>
    <div class="pipeline-step">
      <div class="step-num">5</div>
      <div class="step-title">Publish</div>
      <div class="step-cmd">publish.sh</div>
      <div class="step-output">GitHub Pages</div>
    </div>
    <div class="pipeline-arrow">&rarr;</div>
    <div class="pipeline-step">
      <div class="step-num">6</div>
      <div class="step-title">Hub</div>
      <div class="step-cmd">deploy.sh</div>
      <div class="step-output">IF Hub player</div>
    </div>
  </div>
</section>

<!-- ===== Tools Reference ===== -->
<section id="tools">
  <h2>Tools Reference</h2>

  <!-- build-site.sh -->
  <div class="card">
    <h3>build-site.sh <span class="badge">deploy</span></h3>
    <p class="purpose">Assemble a deployable _site/ directory from web/ + versions/.</p>
    <pre>bash /c/code/ifhub/tools/build-site.sh &lt;game-name&gt;</pre>
    <ul>
      <li>Copies web/* into _site/</li>
      <li>Overlays each versions/vN/ as _site/vN/ (if versions/ exists)</li>
      <li>Projects without versions/ get a simple copy of web/</li>
      <li>Output: <code>projects/&lt;game-name&gt;/_site/</code> (gitignored)</li>
    </ul>
  </div>

  <!-- compile.sh -->
  <div class="card">
    <h3>compile.sh <span class="badge">step 3</span></h3>
    <p class="purpose">Compile story.ni to Glulx binary and set up the web player.</p>
    <pre>bash /c/code/ifhub/tools/compile.sh &lt;game-name&gt;</pre>
    <ul>
      <li>Compiles I7 source to I6 intermediate</li>
      <li>Compiles I6 to Glulx (.ulx)</li>
      <li>Cleans up intermediate .i6 file</li>
      <li>Sets up Parchment web player with base64-encoded binary</li>
    </ul>
  </div>

  <!-- new-project.sh -->
  <div class="card">
    <h3>new-project.sh <span class="badge">step 1</span></h3>
    <p class="purpose">Scaffold a complete new Inform 7 project with all infrastructure.</p>
    <pre>bash /c/code/ifhub/tools/new-project.sh "Game Title" game-name</pre>
    <ul>
      <li>Creates story.ni with starter source</li>
      <li>Sets up test wrappers, project.conf, starter regtest</li>
      <li>Creates CLAUDE.md, .gitignore, GitHub Actions workflow</li>
      <li>Output: <code>projects/&lt;game-name&gt;/</code></li>
    </ul>
  </div>

  <!-- publish.sh -->
  <div class="card">
    <h3>publish.sh <span class="badge">step 5</span></h3>
    <p class="purpose">Deploy a project to GitHub Pages (create repo on first run).</p>
    <pre>bash /c/code/ifhub/tools/publish.sh &lt;game-name&gt; ["commit message"]</pre>
    <ul>
      <li>First run: creates GitHub repo, enables Pages, pushes</li>
      <li>Later runs: commits changes and pushes to trigger redeployment</li>
      <li>Publishes to <code>johnesco.github.io/&lt;game-name&gt;/</code></li>
    </ul>
  </div>

  <!-- regtest.py -->
  <div class="card">
    <h3>regtest.py <span class="badge">step 4</span></h3>
    <p class="purpose">Shared RegTest runner for automated regression testing.</p>
    <pre>python regtest.py [options] &lt;test-file&gt;</pre>
    <ul>
      <li>Runs regression tests against compiled game binaries</li>
      <li>Supports verbose output, test selection, vital mode</li>
      <li>Used by all project test suites via wrapper scripts</li>
    </ul>
  </div>

  <!-- snapshot.sh -->
  <div class="card">
    <h3>snapshot.sh <span class="badge">deploy</span></h3>
    <p class="purpose">Freeze current working source into a version snapshot.</p>
    <pre>bash /c/code/ifhub/tools/snapshot.sh &lt;game-name&gt; &lt;version&gt;
bash /c/code/ifhub/tools/snapshot.sh &lt;game-name&gt; &lt;version&gt; --update</pre>
    <ul>
      <li>New version: copies story.ni, encodes .ulx, copies template from previous version</li>
      <li>Update (--update): refreshes source, binary, and walkthrough data</li>
      <li>Output: <code>projects/&lt;game-name&gt;/versions/&lt;version&gt;/</code></li>
    </ul>
  </div>

  <!-- run-walkthrough.sh -->
  <div class="card">
    <h3>testing/run-walkthrough.sh <span class="badge">step 4</span></h3>
    <p class="purpose">Run a walkthrough through an interpreter with RNG seeding and diagnostics.</p>
    <pre>bash tools/testing/run-walkthrough.sh --config &lt;path&gt; [options]

  --seed 42     Override RNG seed
  --no-seed     True randomness
  --diff        Compare output vs saved baseline
  --quiet       Suppress diagnostics, exit code only
  --no-save     Don't overwrite saved output
  --alt         Use alternate engine</pre>
    <ul>
      <li>Feeds walkthrough commands to interpreter</li>
      <li>Extracts score, checks pass threshold</li>
      <li>Saves transcript for diffing and review</li>
    </ul>
  </div>

  <!-- run-tests.sh -->
  <div class="card">
    <h3>testing/run-tests.sh <span class="badge">step 4</span></h3>
    <p class="purpose">RegTest wrapper with project-specific configuration.</p>
    <pre>bash tools/testing/run-tests.sh --config &lt;path&gt; [options]

  -v            Verbose (show transcripts)
  -l            List available tests
  --vital       Stop on first error
  &lt;test-name&gt;   Run only named test</pre>
    <ul>
      <li>Reads engine/game paths from project.conf</li>
      <li>Delegates to regtest.py with correct arguments</li>
    </ul>
  </div>

  <!-- find-seeds.sh -->
  <div class="card">
    <h3>testing/find-seeds.sh <span class="badge">step 4</span></h3>
    <p class="purpose">Sweep RNG seeds to find ones where the walkthrough achieves a passing score.</p>
    <pre>bash tools/testing/find-seeds.sh --config &lt;path&gt; [options]

  --max 500     Search range (default: 200)
  --stop        Stop on first pass (default)
  --no-stop     Continue sweep after finding pass
  --alt         Use alternate engine</pre>
    <ul>
      <li>Iterates seeds 1..N, running walkthrough for each</li>
      <li>Reports seeds that achieve the pass threshold</li>
      <li>Used after code changes to discover new golden seeds</li>
    </ul>
  </div>

  <!-- setup-web.sh -->
  <div class="card">
    <h3>web/setup-web.sh <span class="badge">step 3</span></h3>
    <p class="purpose">Bootstrap a Parchment web player for any project.</p>
    <pre>bash /c/code/ifhub/tools/web/setup-web.sh \
    --title "My Game" \
    --ulx /path/to/game.ulx \
    --out /path/to/project/web</pre>
    <ul>
      <li>Copies all 7 Parchment library files</li>
      <li>Base64-encodes .ulx into .ulx.js (JSONP format)</li>
      <li>Generates play.html from template</li>
      <li>Called automatically by compile.sh</li>
    </ul>
  </div>
</section>

<!-- ===== Projects ===== -->
<section id="projects">
  <h2>Projects</h2>
  <p>All game projects live under <code>projects/</code>. Each has its own <code>story.ni</code>, tests, and web player.</p>

  <table>
    <thead>
      <tr>
        <th>Project</th>
        <th>Description</th>
        <th>Tests</th>
        <th>Web</th>
        <th>Published</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="name">zork1</td>
        <td>Zork I: Inform 7 Edition (4 version snapshots)</td>
        <td><span class="check">&#10003;</span></td>
        <td><span class="check">&#10003;</span></td>
        <td><a href="https://johnesco.github.io/zork1/">johnesco.github.io/zork1/</a></td>
      </tr>
      <tr>
        <td class="name">dracula</td>
        <td>Dracula's Castle</td>
        <td><span class="dash">&mdash;</span></td>
        <td><span class="check">&#10003;</span></td>
        <td><a href="https://johnesco.github.io/dracula/">johnesco.github.io/dracula/</a></td>
      </tr>
      <tr>
        <td class="name">sample</td>
        <td>Sample practice game</td>
        <td><span class="check">&#10003;</span></td>
        <td><span class="check">&#10003;</span></td>
        <td>Local only</td>
      </tr>
      <tr>
        <td class="name">feverdream</td>
        <td>Fever Dream</td>
        <td><span class="dash">&mdash;</span></td>
        <td><span class="check">&#10003;</span></td>
        <td>Not published</td>
      </tr>
    </tbody>
  </table>
</section>

<!-- ===== Reference Library ===== -->
<section id="reference">
  <h2>Reference Library</h2>
  <p>Language reference guides in <code>reference/</code>. Each covers a major area of Inform 7.</p>

  <table>
    <thead>
      <tr>
        <th>File</th>
        <th>Topic</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>syntax-guide.md</code></td>
        <td>Core Inform 7 syntax and structure</td>
      </tr>
      <tr>
        <td><code>text-formatting.md</code></td>
        <td>Text substitutions and output formatting</td>
      </tr>
      <tr>
        <td><code>world-model.md</code></td>
        <td>Kinds, properties, rooms, regions, backdrops, relations</td>
      </tr>
      <tr>
        <td><code>understanding.md</code></td>
        <td>Understand command, parser tokens, and grammar</td>
      </tr>
      <tr>
        <td><code>lists.md</code></td>
        <td>List operations, sorting, and iteration</td>
      </tr>
      <tr>
        <td><code>extensions.md</code></td>
        <td>Extension system: including, authoring, versioning</td>
      </tr>
      <tr>
        <td><code>descriptions-adaptive-text.md</code></td>
        <td>Descriptions, quantifiers, adaptive text, dynamic change</td>
      </tr>
      <tr>
        <td><code>rulebooks.md</code></td>
        <td>Action processing order, rules, going, persuasion, senses</td>
      </tr>
      <tr>
        <td><code>activities-phrases.md</code></td>
        <td>Activities, phrase definitions, control flow, decisions</td>
      </tr>
    </tbody>
  </table>
</section>

<!-- ===== Quick Commands ===== -->
<section id="commands">
  <h2>Quick Commands</h2>

  <h3>Create a new project</h3>
  <pre class="code-block">bash /c/code/ifhub/tools/new-project.sh "The Haunted Manor" manor</pre>

  <h3>Compile</h3>
  <pre class="code-block">bash /c/code/ifhub/tools/compile.sh sample</pre>

  <h3>Run regression tests</h3>
  <pre class="code-block">wsl -e bash tests/run-tests.sh
wsl -e bash tests/run-tests.sh -v smoke   <span class="comment"># verbose, single test</span></pre>

  <h3>Run walkthrough</h3>
  <pre class="code-block">wsl -e bash tests/run-walkthrough.sh --no-seed --no-save
wsl -e bash tests/run-walkthrough.sh --seed 42</pre>

  <h3>Find golden seeds</h3>
  <pre class="code-block">wsl -e bash tests/find-seeds.sh --max 500</pre>

  <h3>Snapshot a version</h3>
  <pre class="code-block">bash /c/code/ifhub/tools/snapshot.sh zork1 v4          <span class="comment"># new version</span>
bash /c/code/ifhub/tools/snapshot.sh zork1 v3 --update <span class="comment"># refresh existing</span></pre>

  <h3>Assemble site for preview</h3>
  <pre class="code-block">bash /c/code/ifhub/tools/build-site.sh zork1
python -m http.server 8000 --directory projects/zork1/_site</pre>

  <h3>Play locally</h3>
  <pre class="code-block">python -m http.server 8000 --directory projects/sample/web
<span class="comment"># Open http://localhost:8000/play.html</span></pre>

  <h3>Publish to GitHub Pages</h3>
  <pre class="code-block">bash /c/code/ifhub/tools/publish.sh sample "Add kitchen puzzle"</pre>

  <h3>Deploy to IF Hub</h3>
  <pre class="code-block"><span class="comment"># From ifhub/</span>
bash deploy.sh
python -m http.server 8000
<span class="comment"># Open http://localhost:8000/</span></pre>
</section>

<!-- ===== Footer ===== -->
<footer>
  <p><code>C:\code\ifhub\</code> &mdash; <a href="../CLAUDE.md">CLAUDE.md</a></p>
</footer>

</main>

<!-- ===== JS: Active nav highlighting ===== -->
<script>
(function() {
  var links = document.querySelectorAll('nav a[href^="#"]');
  var sections = [];
  links.forEach(function(link) {
    var id = link.getAttribute('href').slice(1);
    var el = document.getElementById(id);
    if (el) sections.push({ el: el, link: link });
  });

  if (!('IntersectionObserver' in window)) return;

  var observer = new IntersectionObserver(function(entries) {
    entries.forEach(function(entry) {
      sections.forEach(function(s) {
        if (s.el === entry.target) {
          if (entry.isIntersecting) {
            links.forEach(function(l) { l.classList.remove('active'); });
            s.link.classList.add('active');
          }
        }
      });
    });
  }, { rootMargin: '-42px 0px -60% 0px', threshold: 0 });

  sections.forEach(function(s) { observer.observe(s.el); });
})();
</script>

</body>
</html>
